<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://yoursite.com">
  <title>woodccc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="每个人都很忙，谢谢你有空来看看">
<meta property="og:type" content="website">
<meta property="og:title" content="woodccc">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="woodccc">
<meta property="og:description" content="每个人都很忙，谢谢你有空来看看">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="woodccc">
<meta name="twitter:description" content="每个人都很忙，谢谢你有空来看看">
  
    <link rel="alternative" href="/atom.xml" title="woodccc" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/main.css?v=4.0.0.css">
  

</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="/images/avatar/avatar.jpg" class="js-avatar">
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Dragon Orange</a></h1>
		</hgroup>

		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/随笔/">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a data-idx="0" q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a data-idx="1" q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a data-idx="2" q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
		        
					<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
		        
					<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
		        
					<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-sort"></i></div>
  		<h1 class="header-author js-mobile-header hide">Dragon Orange</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="/images/avatar/avatar.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Dragon Orange</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/tags/随笔/">随笔</a></li>
		        
		        
		        	<li><a href="/archives/">所有文章</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
			        
						<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            
  
    <article id="post-React-Advanced-guides" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/30/React-Advanced-guides/">React Advanced guides</a>
    </h1>
  

        <a href="/2016/12/30/React-Advanced-guides/" class="archive-article-date">
  	<time datetime="2016-12-30T15:35:26.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-12-30</time>
</a>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Agenda"><a href="#Agenda" class="headerlink" title="Agenda"></a>Agenda</h1><ul>
<li>JSX In Depth</li>
<li>Booleans, Null, and Undefined Are Ignored</li>
<li>Typechecking With PropTypes</li>
<li>Refs and the DOM</li>
<li>Context</li>
</ul>
<h1 id="Agenda-1"><a href="#Agenda-1" class="headerlink" title="Agenda"></a>Agenda</h1><ul>
<li>JSX In Depth</li>
<li>Booleans, Null, and Undefined Are Ignored</li>
<li><strong>Typechecking With PropTypes</strong></li>
<li><strong>Refs and the DOM</strong></li>
<li>Context</li>
</ul>
<h2 id="JSX-In-Depth"><a href="#JSX-In-Depth" class="headerlink" title="JSX In Depth"></a>JSX In Depth</h2><h3 id="Props-Default-to-“True”"><a href="#Props-Default-to-“True”" class="headerlink" title="Props Default to “True”"></a>Props Default to “True”</h3><p>传递一个没有值的属性，其默认值是<strong>true</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;MyTextBox autocomplete /&gt;</div><div class="line"><span class="comment">//is equal</span></div><div class="line">&lt;MyTextBox autocomplete=&#123;<span class="literal">true</span>&#125; /&gt;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;MyTextBox autocomplete/&gt;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span>.props.autocomplete)</div><div class="line"><span class="comment">// true</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;MyTextBox /&gt;</div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span>.props.autocomplete)</div><div class="line"><span class="comment">// undefined</span></div></pre></td></tr></table></figure>
<h3 id="Spread-Attributes"><a href="#Spread-Attributes" class="headerlink" title="Spread Attributes"></a>Spread Attributes</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> Component1 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Greeting</span> <span class="attr">firstName</span>=<span class="string">"Ben"</span> <span class="attr">lastName</span>=<span class="string">"Hector"</span> /&gt;</span></span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">const</span> Component2 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">const</span> props = &#123;<span class="attr">firstName</span>: <span class="string">'Ben'</span>, <span class="attr">lastName</span>: <span class="string">'Hector'</span>&#125;</div><div class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Greeting</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span>;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>高效但是混乱</p>
<blockquote>
<p>We recommend that you use this syntax <strong>sparingly</strong>.</p>
</blockquote>
<h3 id="String-Literals"><a href="#String-Literals" class="headerlink" title="String Literals"></a>String Literals</h3><p>自动删除行首/末位空格，删除空行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">  Hello World</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">  Hello</div><div class="line">  World</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">  Hello World</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="Booleans-Null-and-Undefined-Are-Ignored"><a href="#Booleans-Null-and-Undefined-Are-Ignored" class="headerlink" title="Booleans, Null, and Undefined Are Ignored"></a>Booleans, Null, and Undefined Are Ignored</h2><p>Booleans(false &amp; true), null, undefined都是合法值</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> /&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;false&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;null&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;true&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>全部 render null</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">const messages = []</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">  &#123;messages.length &amp;&amp;</div><div class="line">    <span class="tag">&lt;<span class="name">MessageList</span> <span class="attr">messages</span>=<span class="string">&#123;messages&#125;</span> /&gt;</span></div><div class="line">  &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>number ‘0’不会被转化为 false</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">  &#123;messages.length &gt; 0 &amp;&amp;</div><div class="line">    <span class="tag">&lt;<span class="name">MessageList</span> <span class="attr">messages</span>=<span class="string">&#123;messages&#125;</span> /&gt;</span></div><div class="line">  &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>确保在&amp;&amp;前面的是booleans</p>
<p>若要显示‘false &amp; true, null, undefined’，需转换为 string</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">  My JavaScript variable is &#123;String(myVariable)&#125;.</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="Typechecking-With-PropTypes"><a href="#Typechecking-With-PropTypes" class="headerlink" title="Typechecking With PropTypes"></a>Typechecking With PropTypes</h2><p>我经常使用的 PropTypes</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">MyComponent.propTypes = &#123;</div><div class="line">  optionalArray: React.PropTypes.array,</div><div class="line">  optionalBool: React.PropTypes.bool,</div><div class="line">  optionalFunc: React.PropTypes.func,</div><div class="line">  optionalNumber: React.PropTypes.number,</div><div class="line">  optionalObject: React.PropTypes.object,</div><div class="line">  optionalString: React.PropTypes.string,</div><div class="line">  optionalSymbol: React.PropTypes.symbol,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>限制在枚举的数组中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">optionalEnum: React.PropTypes.oneOf([<span class="string">'News'</span>, <span class="string">'Photos'</span>])</div></pre></td></tr></table></figure>
<p>限制在多个类型中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">optionalUnion: React.PropTypes.oneOfType([</div><div class="line">	React.PropTypes.string,</div><div class="line">	React.PropTypes.number,</div><div class="line">	React.PropTypes.instanceOf(Message)</div><div class="line">])</div></pre></td></tr></table></figure>
<p>限定数组中 value 的类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">optionalArrayOf: React.PropTypes.arrayOf(React.PropTypes.number)</div></pre></td></tr></table></figure>
<p>限定对象中 value 的类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">optionalObjectOf: React.PropTypes.objectOf(React.PropTypes.number)</div></pre></td></tr></table></figure>
<p>限定数据结构</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">optionalObjectWithShape: React.PropTypes.shape(&#123;</div><div class="line">	<span class="attr">color</span>: React.PropTypes.string,</div><div class="line">	<span class="attr">fontSize</span>: React.PropTypes.number</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>shape只能用在对象中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">optionalObjectWithShape: React.PropTypes.shape(&#123;</div><div class="line">  <span class="attr">colors</span>: React.PropTypes.shape(&#123;</div><div class="line">    <span class="attr">backgroundColor</span>: React.PropTypes.string.isRequired</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>自定义一个validator，异常情况 return Error 对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">customProp: <span class="function">(<span class="params">props, propName, componentName</span>) =&gt;</span> &#123;</div><div class="line">	<span class="keyword">if</span> (!<span class="regexp">/matchme/</span>.test(props[propName])) &#123;</div><div class="line">	  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</div><div class="line">	    <span class="string">'Invalid prop `'</span> + propName + <span class="string">'` supplied to'</span> +</div><div class="line">	    <span class="string">' `'</span> + componentName + <span class="string">'`. Validation failed.'</span></div><div class="line">	  )</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以用箭头函数</p>
<p>自定义<code>arrayOf</code> 和 <code>objectOf</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">customArrayProp: React.PropTypes.arrayOf(<span class="function"><span class="keyword">function</span>(<span class="params">propValue, key, componentName, location, propFullName</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'location'</span>, location)</div><div class="line">  <span class="comment">//location prop</span></div><div class="line">  </div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'propFullName'</span>, propFullName)</div><div class="line">  <span class="comment">//propFullName customArrayProp[0]</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>遍历每一个元素</p>
<h3 id="Default-Prop-Values"><a href="#Default-Prop-Values" class="headerlink" title="Default Prop Values"></a>Default Prop Values</h3><p>会不会报错？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeting</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="keyword">static</span> propTypes = &#123;</div><div class="line">    <span class="attr">name</span>: PropTypes.string.isRequired</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">static</span> defaultProps = &#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'Stranger'</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>propTypes类型检查在defaultProps赋值后进行</p>
<h2 id="Refs-and-the-DOM"><a href="#Refs-and-the-DOM" class="headerlink" title="Refs and the DOM"></a>Refs and the DOM</h2><h3 id="The-ref-Callback-Attribute"><a href="#The-ref-Callback-Attribute" class="headerlink" title="The ref Callback Attribute"></a>The ref Callback Attribute</h3><p>ref 属性可以接受一个回调函数</p>
<p>并且在组件mounted和unmounted时立即调用</p>
<p>回调函数的参数是该 DOM element，unmounted的时候是 null</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(props) &#123;</div><div class="line">    <span class="keyword">super</span>(props)</div><div class="line">    <span class="keyword">this</span>.handleFocus = <span class="keyword">this</span>.handleFocus.bind(<span class="keyword">this</span>)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  handleFocus() &#123;</div><div class="line">    <span class="keyword">this</span>.textInput.focus()</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;div&gt;</div><div class="line">        &lt;input</div><div class="line">          type="text"</div><div class="line">          ref=&#123;(input) =&gt; &#123; this.textInput = input &#125;&#125;</div><div class="line">        /&gt;</div><div class="line">        &lt;input</div><div class="line">          type="button"</div><div class="line">          value="Focus the text input"</div><div class="line">          onClick=&#123;this.handleFocus&#125;</div><div class="line">        /&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutoFocusTextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  componentDidMount() &#123;</div><div class="line">    <span class="keyword">this</span>.customTextInput.handleFocus()</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">CustomTextInput</span></span></span></div><div class="line">        <span class="attr">ref</span>=<span class="string">&#123;(customTextInput)</span> =&gt; &#123; this.customTextInput = customTextInput &#125;&#125;</div><div class="line">      /&gt;</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  handleFocus() &#123;</div><div class="line">    <span class="keyword">this</span>.textInput.focus()</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">input</span></span></span></div><div class="line">        <span class="attr">ref</span>=<span class="string">&#123;(input)</span> =&gt; &#123; this.textInput = input&#125;</div><div class="line">      /&gt;</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Functional-components"><a href="#Functional-components" class="headerlink" title="Functional components"></a>Functional components</h3><p>函数式组件，需要提前声明</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">CustomTextInput</span>(<span class="params">props</span>) </span>&#123;</div><div class="line">  <span class="comment">// textInput must be declared here so the ref callback can refer to it</span></div><div class="line">  <span class="keyword">let</span> textInput = <span class="literal">null</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleClick</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    textInput.focus()</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;div&gt;</div><div class="line">      &lt;input</div><div class="line">        type="text"</div><div class="line">        ref=&#123;(input) =&gt; &#123; textInput = input; &#125;&#125; /&gt;</div><div class="line">      &lt;input</div><div class="line">        type="button"</div><div class="line">        value="Focus the text input"</div><div class="line">        onClick=&#123;handleClick&#125;</div><div class="line">      /&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  )</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Don’t-Overuse-Refs"><a href="#Don’t-Overuse-Refs" class="headerlink" title="Don’t Overuse Refs"></a>Don’t Overuse Refs</h3><h2 id="Reconciliation"><a href="#Reconciliation" class="headerlink" title="Reconciliation"></a>Reconciliation</h2><h3 id="The-Diffing-Algorithm"><a href="#The-Diffing-Algorithm" class="headerlink" title="The Diffing Algorithm"></a>The Diffing Algorithm</h3><h4 id="Elements-Of-Different-Types"><a href="#Elements-Of-Different-Types" class="headerlink" title="Elements Of Different Types"></a>Elements Of Different Types</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">Counter</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">Counter</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div></pre></td></tr></table></figure>
<p>这里的<code>&lt;Counter /&gt;</code>是一个完全新的组件，旧的状态都将清除</p>
<p>当根元素类型变化，毁掉旧的树，创建新的树</p>
<p>包含在树里的组件会被卸载，所有状态清空</p>
<h4 id="DOM-Elements-Of-The-Same-Type"><a href="#DOM-Elements-Of-The-Same-Type" class="headerlink" title="DOM Elements Of The Same Type"></a>DOM Elements Of The Same Type</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"before"</span> <span class="attr">title</span>=<span class="string">"stuff"</span> /&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"after"</span> <span class="attr">title</span>=<span class="string">"stuff"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>类型相同，只更新属性</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:</span> '<span class="attr">red</span>', <span class="attr">fontWeight:</span> '<span class="attr">bold</span>'&#125;&#125; /&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:</span> '<span class="attr">green</span>', <span class="attr">fontWeight:</span> '<span class="attr">bold</span>'&#125;&#125; /&gt;</span></div></pre></td></tr></table></figure>
<p>只更新 color，不更新 fontWeight</p>
<h4 id="Recursing-On-Children"><a href="#Recursing-On-Children" class="headerlink" title="Recursing On Children"></a>Recursing On Children</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>first<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>second<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>first<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>second<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>third<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<p>在末尾添加，前面的不会重新渲染</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span> first <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span> second <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span> third <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span> first <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span> second <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<p>更新所有<code>&lt;li&gt;</code></p>
<p>[slide]<br>{:&amp;.bounceIn}</p>
<h4 id="Keys"><a href="#Keys" class="headerlink" title="Keys"></a>Keys</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"2015"</span>&gt;</span>Duke<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"2016"</span>&gt;</span>Villanova<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"2014"</span>&gt;</span>Connecticut<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"2015"</span>&gt;</span>Duke<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"2016"</span>&gt;</span>Villanova<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<p>添加 key，更加高效</p>
<p>key 只需在兄弟节点中唯一</p>
<h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><h3 id="Why-Not-To-Use-Context"><a href="#Why-Not-To-Use-Context" class="headerlink" title="Why Not To Use Context"></a>Why Not To Use Context</h3><p>如果希望稳定，一定不要用 context。</p>
<p>这是一个实验性 API，可能会在后续版本中移除</p>
<h3 id="How-To-Use-Context"><a href="#How-To-Use-Context" class="headerlink" title="How To Use Context"></a>How To Use Context</h3><p>不用 context ，组件结构如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;&#123;background:</span> <span class="attr">this.props.color</span>&#125;&#125;&gt;</span></span></div><div class="line">        &#123;this.props.children&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Message</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">        &#123;this.props.text&#125; <span class="tag">&lt;<span class="name">Button</span> <span class="attr">color</span>=<span class="string">&#123;this.props.color&#125;</span>&gt;</span>Delete<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MessageList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">const</span> color = <span class="string">"purple"</span>;</div><div class="line">    <span class="keyword">const</span> children = <span class="keyword">this</span>.props.messages.map(<span class="function">(<span class="params">message</span>) =&gt;</span></div><div class="line">      &lt;Message text=&#123;message.text&#125; color=&#123;color&#125; /&gt;</div><div class="line">    )</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用 context传递 props</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;&#123;background:</span> <span class="attr">this.context.color</span>&#125;&#125;&gt;</span></span></div><div class="line">        &#123;this.props.children&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Button.contextTypes = &#123;</div><div class="line">  <span class="attr">color</span>: React.PropTypes.string</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Message</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">        &#123;this.props.text&#125; <span class="tag">&lt;<span class="name">Button</span>&gt;</span>Delete<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MessageList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  getChildContext() &#123;</div><div class="line">    <span class="keyword">return</span> &#123;<span class="attr">color</span>: <span class="string">"purple"</span>&#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">const</span> children = <span class="keyword">this</span>.props.messages.map(<span class="function">(<span class="params">message</span>) =&gt;</span></div><div class="line">      &lt;Message text=&#123;message.text&#125; /&gt;</div><div class="line">    )</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>添加childContextTypes 和 getChildContext</p>
<p>如果未定义contextTypes，context是一个空对象</p>
<h1 id="Thanks"><a href="#Thanks" class="headerlink" title="Thanks!"></a>Thanks!</h1>
      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/12/30/React-Advanced-guides/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-Learn-React-Advanced-guides-note" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/30/Learn-React-Advanced-guides-note/">Learn React Advanced guides note</a>
    </h1>
  

        <a href="/2016/12/30/Learn-React-Advanced-guides-note/" class="archive-article-date">
  	<time datetime="2016-12-30T15:28:54.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-12-30</time>
</a>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This is a note for learn React Advanced guides, you can learn it in <a href="https://facebook.github.io/react/docs/jsx-in-depth.html" target="_blank" rel="external">facebook.github.io/react</a>.</p>
<h2 id="JSX-In-Depth"><a href="#JSX-In-Depth" class="headerlink" title="JSX In Depth"></a>JSX In Depth</h2><h3 id="Props-Default-to-“True”"><a href="#Props-Default-to-“True”" class="headerlink" title="Props Default to “True”"></a>Props Default to “True”</h3><p>If you pass no value for a prop, it defaults to true. These two JSX expressions are equivalent:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;MyTextBox autocomplete /&gt;</div><div class="line"><span class="comment">//is equal</span></div><div class="line">&lt;MyTextBox autocomplete=&#123;<span class="literal">true</span>&#125; /&gt;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;MyTextBox active/&gt;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span>.props.active)</div><div class="line"><span class="comment">// true</span></div><div class="line"></div><div class="line">&lt;MyTextBox /&gt;</div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span>.props.active)</div><div class="line"><span class="comment">// undefined</span></div></pre></td></tr></table></figure>
<h3 id="Spread-Attributes"><a href="#Spread-Attributes" class="headerlink" title="Spread Attributes"></a>Spread Attributes</h3><p>Spread attributes can be useful when you are building generic containers. However, they can also make your code <strong>messy</strong> by making it easy to pass a lot of <strong>irrelevant</strong> props to components that don’t care about them. We recommend that you use this syntax <strong>sparingly</strong>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">App1</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &lt;Greeting firstName="Ben" lastName="Hector" /&gt;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">function App2() &#123;</div><div class="line">  const props = &#123;firstName: 'Ben', lastName: 'Hector'&#125;;</div><div class="line">  return &lt;Greeting &#123;...props&#125; /&gt;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="String-Literals"><a href="#String-Literals" class="headerlink" title="String Literals"></a>String Literals</h3><p>JSX removes whitespace at the beginning and ending of a line. It also removes blank lines. New lines adjacent to tags are removed; new lines that occur in the middle of string literals are condensed into a single space. So these all render to the same thing:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">  Hello World</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">  Hello</div><div class="line">  World</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">  Hello World</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="Booleans-Null-and-Undefined-Are-Ignored"><a href="#Booleans-Null-and-Undefined-Are-Ignored" class="headerlink" title="Booleans, Null, and Undefined Are Ignored"></a>Booleans, Null, and Undefined Are Ignored</h2><p>false, null, undefined, and true are valid children. They simply don’t render. These JSX expressions will all render to the same thing:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;false&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;null&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;true&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>One caveat is that some “falsy” values, such as the 0 number, are still rendered by React. For example, this code will not behave as you might expect because 0 will be printed when props.messages is an empty array:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">  &#123;props.messages.length &amp;&amp;</div><div class="line">    <span class="tag">&lt;<span class="name">MessageList</span> <span class="attr">messages</span>=<span class="string">&#123;props.messages&#125;</span> /&gt;</span></div><div class="line">  &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>To fix this, make sure that the expression before &amp;&amp; is always boolean:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">  &#123;props.messages.length &gt; 0 &amp;&amp;</div><div class="line">    <span class="tag">&lt;<span class="name">MessageList</span> <span class="attr">messages</span>=<span class="string">&#123;props.messages&#125;</span> /&gt;</span></div><div class="line">  &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Conversely, if you want a value like false, true, null, or undefined to appear in the output, you have to convert it to a string first:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">  My JavaScript variable is &#123;String(myVariable)&#125;.</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="Typechecking-With-PropTypes"><a href="#Typechecking-With-PropTypes" class="headerlink" title="Typechecking With PropTypes"></a>Typechecking With PropTypes</h2><p>Regular PropTypes:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">MyComponent.propTypes = &#123;</div><div class="line">  <span class="attr">optionalArray</span>: React.PropTypes.array,</div><div class="line">  <span class="attr">optionalBool</span>: React.PropTypes.bool,</div><div class="line">  <span class="attr">optionalFunc</span>: React.PropTypes.func,</div><div class="line">  <span class="attr">optionalNumber</span>: React.PropTypes.number,</div><div class="line">  <span class="attr">optionalObject</span>: React.PropTypes.object,</div><div class="line">  <span class="attr">optionalString</span>: React.PropTypes.string,</div><div class="line">  <span class="attr">optionalSymbol</span>: React.PropTypes.symbol,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>You can ensure that your prop is limited to specific values by treating it as an enum:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">optionalEnum: React.PropTypes.oneOf([<span class="string">'News'</span>, <span class="string">'Photos'</span>])</div></pre></td></tr></table></figure>
<p>An object that could be one of many types:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">optionalUnion: React.PropTypes.oneOfType([</div><div class="line">	React.PropTypes.string,</div><div class="line">	React.PropTypes.number,</div><div class="line">	React.PropTypes.instanceOf(Message)</div><div class="line">])</div></pre></td></tr></table></figure>
<p>An array of a certain type:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">optionalArrayOf: React.PropTypes.arrayOf(React.PropTypes.number)</div></pre></td></tr></table></figure>
<p>An object with property values of a certain type:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">optionalObjectOf: React.PropTypes.objectOf(React.PropTypes.number)</div></pre></td></tr></table></figure>
<p>An object taking on a particular shape:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">optionalObjectWithShape: React.PropTypes.shape(&#123;</div><div class="line">	<span class="attr">color</span>: React.PropTypes.string,</div><div class="line">	<span class="attr">fontSize</span>: React.PropTypes.number</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>You can also specify a custom validator. It should return an Error object if the validation fails. Don’t <code>console.warn</code> or throw, as this won’t work inside <code>oneOfType</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">customProp: <span class="function"><span class="keyword">function</span>(<span class="params">props, propName, componentName</span>) </span>&#123;</div><div class="line">	<span class="keyword">if</span> (!<span class="regexp">/matchme/</span>.test(props[propName])) &#123;</div><div class="line">	  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</div><div class="line">	    <span class="string">'Invalid prop `'</span> + propName + <span class="string">'` supplied to'</span> +</div><div class="line">	    <span class="string">' `'</span> + componentName + <span class="string">'`. Validation failed.'</span></div><div class="line">	  );</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>You can also supply a custom validator to <code>arrayOf</code> and <code>objectOf</code>.It should return an Error object if the validation fails. The validator will be called for each key in the array or object. The first two arguments of the validator are the array or object itself, and the current item’s key.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">customArrayProp: React.PropTypes.arrayOf(<span class="function"><span class="keyword">function</span>(<span class="params">propValue, key, componentName, location, propFullName</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (!<span class="regexp">/matchme/</span>.test(propValue[key])) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</div><div class="line">      <span class="string">'Invalid prop `'</span> + propFullName + <span class="string">'` supplied to'</span> +</div><div class="line">      <span class="string">' `'</span> + componentName + <span class="string">'`. Validation failed.'</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Default-Prop-Values"><a href="#Default-Prop-Values" class="headerlink" title="Default Prop Values"></a>Default Prop Values</h3><p>The propTypes typechecking happens after defaultProps are resolved, so typechecking will also apply to the defaultProps:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeting</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Specifies the default values for props:</span></div><div class="line">Greeting.defaultProps = &#123;</div><div class="line">  <span class="attr">name</span>: <span class="string">'Stranger'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Refs-and-the-DOM"><a href="#Refs-and-the-DOM" class="headerlink" title="Refs and the DOM"></a>Refs and the DOM</h2><h3 id="The-ref-Callback-Attribute"><a href="#The-ref-Callback-Attribute" class="headerlink" title="The ref Callback Attribute"></a>The ref Callback Attribute</h3><p>The ref attribute takes a callback function, and the callback will be executed immediately after the component is mounted or unmounted.</p>
<p>When the ref attribute is used on an HTML element, the ref callback receives the underlying DOM element as its argument. For example, this code uses the ref callback to store a reference to a DOM node:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(props) &#123;</div><div class="line">    <span class="keyword">super</span>(props);</div><div class="line">    <span class="keyword">this</span>.handleFocus = <span class="keyword">this</span>.handleFocus.bind(<span class="keyword">this</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  handleFocus() &#123;</div><div class="line">    <span class="comment">// Explicitly focus the text input using the raw DOM API</span></div><div class="line">    <span class="keyword">this</span>.textInput.focus();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="comment">// Use the `ref` callback to store a reference to the text input DOM</span></div><div class="line">    <span class="comment">// element in this.textInput.</span></div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;div&gt;</div><div class="line">        &lt;input</div><div class="line">          type="text"</div><div class="line">          ref=&#123;(input) =&gt; &#123; this.textInput = input; &#125;&#125; /&gt;</div><div class="line">        &lt;input</div><div class="line">          type="button"</div><div class="line">          value="Focus the text input"</div><div class="line">          onClick=&#123;this.handleFocus&#125;</div><div class="line">        /&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>React will call the ref callback with the DOM element when the component mounts, and call it with null when it unmounts.</p>
<p>When the ref attribute is used on a custom component, the ref callback receives the mounted instance of the component as its argument. For example, if we wanted to wrap the CustomTextInput above to simulate it being clicked immediately after mounting:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutoFocusTextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  componentDidMount() &#123;</div><div class="line">    <span class="keyword">this</span>.customTextInput.handleFocus();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">CustomTextInput</span></span></span></div><div class="line">        <span class="attr">ref</span>=<span class="string">&#123;(customTextInput)</span> =&gt; &#123; this.customTextInput = customTextInput; &#125;&#125; /&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Functional-components"><a href="#Functional-components" class="headerlink" title="Functional components"></a>Functional components</h3><p>TextInput must be declared here so the ref callback can refer to it</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">CustomTextInput</span>(<span class="params">props</span>) </span>&#123;</div><div class="line">  <span class="comment">// textInput must be declared here so the ref callback can refer to it</span></div><div class="line">  <span class="keyword">let</span> textInput = <span class="literal">null</span>;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleClick</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    textInput.focus();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;div&gt;</div><div class="line">      &lt;input</div><div class="line">        type="text"</div><div class="line">        ref=&#123;(input) =&gt; &#123; textInput = input; &#125;&#125; /&gt;</div><div class="line">      &lt;input</div><div class="line">        type="button"</div><div class="line">        value="Focus the text input"</div><div class="line">        onClick=&#123;handleClick&#125;</div><div class="line">      /&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  );  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Don’t-Overuse-Refs"><a href="#Don’t-Overuse-Refs" class="headerlink" title="Don’t Overuse Refs"></a>Don’t Overuse Refs</h3><p>Your first inclination may be to use refs to “make things happen” in your app. If this is the case, take a moment and think more critically about where state should be owned in the component hierarchy.</p>
<h2 id="Reconciliation"><a href="#Reconciliation" class="headerlink" title="Reconciliation"></a>Reconciliation</h2><h3 id="The-Diffing-Algorithm"><a href="#The-Diffing-Algorithm" class="headerlink" title="The Diffing Algorithm"></a>The Diffing Algorithm</h3><h4 id="Elements-Of-Different-Types"><a href="#Elements-Of-Different-Types" class="headerlink" title="Elements Of Different Types"></a>Elements Of Different Types</h4><p>Whenever the root elements have different types, React will tear down the old tree and build the new tree from scratch.</p>
<p>Any components below the root will also get unmounted and have their state destroyed. For example, when diffing:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">Counter</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">Counter</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div></pre></td></tr></table></figure>
<p>This will destroy the old Counter and remount a new one.</p>
<h4 id="DOM-Elements-Of-The-Same-Type"><a href="#DOM-Elements-Of-The-Same-Type" class="headerlink" title="DOM Elements Of The Same Type"></a>DOM Elements Of The Same Type</h4><p>When comparing two React DOM elements of the same type, React looks at the attributes of both, keeps the same underlying DOM node, and only updates the changed attributes. For example:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"before"</span> <span class="attr">title</span>=<span class="string">"stuff"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"after"</span> <span class="attr">title</span>=<span class="string">"stuff"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>When converting between these two elements, React knows to only modify the color style, not the fontWeight.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:</span> '<span class="attr">red</span>', <span class="attr">fontWeight:</span> '<span class="attr">bold</span>'&#125;&#125; /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:</span> '<span class="attr">green</span>', <span class="attr">fontWeight:</span> '<span class="attr">bold</span>'&#125;&#125; /&gt;</span></div></pre></td></tr></table></figure>
<h4 id="Recursing-On-Children"><a href="#Recursing-On-Children" class="headerlink" title="Recursing On Children"></a>Recursing On Children</h4><p>When adding an element at the end of the children, converting between these two trees works well:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>first<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>second<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>first<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>second<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>third<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<p>React will mutate every child instead of realizing it can keep the <li>Duke</li> and <li>Villanova</li> subtrees intact. This inefficiency can be a problem.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>Duke<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>Villanova<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>Connecticut<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>Duke<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>Villanova<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="Keys"><a href="#Keys" class="headerlink" title="Keys"></a>Keys</h4><p>Adding a key to our inefficient example above can make the tree conversion efficient:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"2015"</span>&gt;</span>Duke<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"2016"</span>&gt;</span>Villanova<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"2014"</span>&gt;</span>Connecticut<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"2015"</span>&gt;</span>Duke<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"2016"</span>&gt;</span>Villanova<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<p>The key only has to be unique among its siblings, not globally unique.</p>
<p>As a last resort, you can pass item’s index in the array as a key. This can work well if the items are never reordered, but reorders will be slow.</p>
<h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><h3 id="Why-Not-To-Use-Context"><a href="#Why-Not-To-Use-Context" class="headerlink" title="Why Not To Use Context"></a>Why Not To Use Context</h3><p>If you want your application to be stable, don’t use context. It is an experimental API and it is likely to break in future releases of React.</p>
<h3 id="How-To-Use-Context"><a href="#How-To-Use-Context" class="headerlink" title="How To Use Context"></a>How To Use Context</h3><p>Suppose you have a structure like:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;&#123;background:</span> <span class="attr">this.props.color</span>&#125;&#125;&gt;</span></span></div><div class="line">        &#123;this.props.children&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Message</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">        &#123;this.props.text&#125; <span class="tag">&lt;<span class="name">Button</span> <span class="attr">color</span>=<span class="string">&#123;this.props.color&#125;</span>&gt;</span>Delete<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MessageList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">const</span> color = <span class="string">"purple"</span>;</div><div class="line">    <span class="keyword">const</span> children = <span class="keyword">this</span>.props.messages.map(<span class="function">(<span class="params">message</span>) =&gt;</span></div><div class="line">      &lt;Message text=&#123;message.text&#125; color=&#123;color&#125; /&gt;</div><div class="line">    );</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Using context, we can pass this through the tree automatically:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;&#123;background:</span> <span class="attr">this.context.color</span>&#125;&#125;&gt;</span></span></div><div class="line">        &#123;this.props.children&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Button.contextTypes = &#123;</div><div class="line">  <span class="attr">color</span>: React.PropTypes.string</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Message</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">        &#123;this.props.text&#125; <span class="tag">&lt;<span class="name">Button</span>&gt;</span>Delete<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MessageList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  getChildContext() &#123;</div><div class="line">    <span class="keyword">return</span> &#123;<span class="attr">color</span>: <span class="string">"purple"</span>&#125;;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">const</span> children = <span class="keyword">this</span>.props.messages.map(<span class="function">(<span class="params">message</span>) =&gt;</span></div><div class="line">      &lt;Message text=&#123;message.text&#125; /&gt;</div><div class="line">    );</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">MessageList.childContextTypes = &#123;</div><div class="line">  <span class="attr">color</span>: React.PropTypes.string</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>By adding childContextTypes and getChildContext to MessageList (the context provider), React passes the information down automatically and any component in the subtree (in this case, Button) can access it by defining contextTypes.</p>
<p>If contextTypes is not defined, then context will be an empty object.</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/12/30/Learn-React-Advanced-guides-note/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-代码可读性-格式和测试" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/30/代码可读性-格式和测试/">代码可读性-格式和测试</a>
    </h1>
  

        <a href="/2016/12/30/代码可读性-格式和测试/" class="archive-article-date">
  	<time datetime="2016-12-30T15:15:34.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-12-30</time>
</a>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="代码可读性"><a href="#代码可读性" class="headerlink" title="代码可读性"></a>代码可读性</h2><h3 id="格式和测试"><a href="#格式和测试" class="headerlink" title="格式和测试"></a>格式和测试</h3><h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="读代码就像是读文章、小说、新闻"><a href="#读代码就像是读文章、小说、新闻" class="headerlink" title="读代码就像是读文章、小说、新闻"></a>读代码就像是读文章、小说、新闻</h3><p>阅读的顺序一般来说都是从上到下，从左到右</p>
<ul>
<li>竖向格式 {:&amp;.rollIn}</li>
<li>横向格式</li>
</ul>
<h2 id="竖向格式"><a href="#竖向格式" class="headerlink" title="竖向格式"></a>竖向格式</h2><h3 id="距离产生美"><a href="#距离产生美" class="headerlink" title="距离产生美"></a>距离产生美</h3><p>有距离的代码是这样的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">…</div><div class="line">	<span class="keyword">const</span> &#123; UDFs, type &#125; = <span class="keyword">this</span>.props</div><div class="line">	</div><div class="line">	<span class="keyword">const</span> textFields = <span class="keyword">this</span>.handleGroupByType(<span class="string">'Text'</span>)</div><div class="line">	<span class="keyword">const</span> numericFields = <span class="keyword">this</span>.handleGroupByType(<span class="string">'Numeric'</span>)</div><div class="line">    <span class="keyword">const</span> timeFields = <span class="keyword">this</span>.handleGroupByType(<span class="string">'Time'</span>)</div><div class="line">    <span class="keyword">const</span> datetimeFields = concat(<span class="keyword">this</span>.handleGroupByType(<span class="string">'Datetime'</span>), timeFields)</div><div class="line">    </div><div class="line">    <span class="keyword">const</span> UDFsFunctions = sortBy(filterByUdfTypes(UDFs, [FUNCTION_TYPE_UDF]), UDF =&gt; UDF.name)</div><div class="line">    <span class="keyword">const</span> UDAFsFunctions = filterByUdfTypes(UDFs, [FUNCTION_TYPE_UDAF])</div><div class="line">    <span class="keyword">const</span> NORMALsFunctions = filterByUdfTypes(UDFs, [FUNCTION_TYPE_NORMAL])</div><div class="line">    <span class="keyword">const</span> basicFunctions = isNotMetric(type) ? [...UDFsFunctions, ...NORMALsFunctions] : UDFsFunctions</div><div class="line">    </div><div class="line">    <span class="keyword">const</span> numericFunctions = filterByReturnType(basicFunctions, <span class="string">'Numeric'</span>)</div><div class="line">    <span class="keyword">const</span> textFunctions = filterByReturnType(basicFunctions, <span class="string">'Text'</span>)</div><div class="line">    <span class="keyword">const</span> datetimeFunctions = filterByReturnType(basicFunctions, <span class="string">'Datetime'</span>)</div><div class="line">    </div><div class="line">    <span class="keyword">const</span> distinctUDAFs = uniqBy(UDAFsFunctions, <span class="string">'name'</span>)</div><div class="line">    </div><div class="line">    <span class="keyword">const</span> aggregateFunctions = sortBy(distinctUDAFs, <span class="string">'name'</span>)</div><div class="line">    <span class="keyword">const</span> aggregateFunctionsFilter = filter(aggregateFunctions, aggregateFunction =&gt; aggregateFunction.tag != <span class="string">'None'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> (</div><div class="line">…</div></pre></td></tr></table></figure>
<p>没有距离就变成下面这样了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">…</div><div class="line">	<span class="keyword">const</span> &#123; UDFs, type &#125; = <span class="keyword">this</span>.props</div><div class="line">	<span class="keyword">const</span> textFields = <span class="keyword">this</span>.handleGroupByType(<span class="string">'Text'</span>)</div><div class="line">	<span class="keyword">const</span> numericFields = <span class="keyword">this</span>.handleGroupByType(<span class="string">'Numeric'</span>)</div><div class="line">    <span class="keyword">const</span> timeFields = <span class="keyword">this</span>.handleGroupByType(<span class="string">'Time'</span>)</div><div class="line">    <span class="keyword">const</span> datetimeFields = concat(<span class="keyword">this</span>.handleGroupByType(<span class="string">'Datetime'</span>), timeFields)</div><div class="line">    <span class="keyword">const</span> UDFsFunctions = sortBy(filterByUdfTypes(UDFs, [FUNCTION_TYPE_UDF]), UDF =&gt; UDF.name)</div><div class="line">    <span class="keyword">const</span> UDAFsFunctions = filterByUdfTypes(UDFs, [FUNCTION_TYPE_UDAF])</div><div class="line">    <span class="keyword">const</span> NORMALsFunctions = filterByUdfTypes(UDFs, [FUNCTION_TYPE_NORMAL])</div><div class="line">    <span class="keyword">const</span> basicFunctions = isNotMetric(type) ? [...UDFsFunctions, ...NORMALsFunctions] : UDFsFunctions</div><div class="line">    <span class="keyword">const</span> numericFunctions = filterByReturnType(basicFunctions, <span class="string">'Numeric'</span>)</div><div class="line">    <span class="keyword">const</span> textFunctions = filterByReturnType(basicFunctions, <span class="string">'Text'</span>)</div><div class="line">    <span class="keyword">const</span> datetimeFunctions = filterByReturnType(basicFunctions, <span class="string">'Datetime'</span>)</div><div class="line">    <span class="keyword">const</span> distinctUDAFs = uniqBy(UDAFsFunctions, <span class="string">'name'</span>)  </div><div class="line">    <span class="keyword">const</span> aggregateFunctions = sortBy(distinctUDAFs, <span class="string">'name'</span>)</div><div class="line">    <span class="keyword">const</span> aggregateFunctionsFilter = filter(aggregateFunctions, aggregateFunction =&gt; aggregateFunction.tag != <span class="string">'None'</span>)</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">…</div></pre></td></tr></table></figure>
<p>我也经常这样子做代码格式的处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></div><div class="line"><span class="keyword">import</span> Radio <span class="keyword">from</span> <span class="string">'antd/lib/radio'</span></div><div class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></div><div class="line"><span class="keyword">import</span> &#123; bindActionCreators &#125; <span class="keyword">from</span> <span class="string">'redux'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> <span class="string">'components/commons/Button'</span></div><div class="line"><span class="keyword">import</span> VirtualFieldDropDownMenu <span class="keyword">from</span> <span class="string">'./VirtualFieldDropDownMenu'</span></div><div class="line"><span class="keyword">import</span> VirtualFieldPreview <span class="keyword">from</span> <span class="string">'./VirtualFieldPreview'</span></div><div class="line"><span class="keyword">import</span> VirtualMetricPreview <span class="keyword">from</span> <span class="string">'./VirtualMetricPreview'</span></div><div class="line"><span class="keyword">import</span> Notification <span class="keyword">from</span> <span class="string">'components/Notification'</span></div><div class="line"><span class="keyword">import</span> Title <span class="keyword">from</span> <span class="string">'./Title'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123; insertField, insertFunction, filterByReturnType, filterByUdfTypes &#125; <span class="keyword">from</span> <span class="string">'./virtualFieldService'</span></div><div class="line"><span class="keyword">import</span> isNotUndefined <span class="keyword">from</span> <span class="string">'utils/lodash/isNotUndefined'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> ReportActions <span class="keyword">from</span> <span class="string">'actions/report'</span></div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> DataSetFieldsActions <span class="keyword">from</span> <span class="string">'actions/dataSetFields'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> ReportSelectors <span class="keyword">from</span> <span class="string">'selectors/report'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> isUndefined <span class="keyword">from</span> <span class="string">'lodash/isUndefined'</span></div><div class="line"><span class="keyword">import</span> trim <span class="keyword">from</span> <span class="string">'lodash/trim'</span></div><div class="line"><span class="keyword">import</span> isEmpty <span class="keyword">from</span> <span class="string">'lodash/isEmpty'</span></div><div class="line"><span class="keyword">import</span> concat <span class="keyword">from</span> <span class="string">'lodash/concat'</span></div><div class="line"><span class="keyword">import</span> uniqBy <span class="keyword">from</span> <span class="string">'lodash/uniqBy'</span></div><div class="line"><span class="keyword">import</span> sortBy <span class="keyword">from</span> <span class="string">'lodash/orderBy'</span></div><div class="line"><span class="keyword">import</span> filter <span class="keyword">from</span> <span class="string">'lodash/filter'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123; FUNCTION_TYPE_UDF, FUNCTION_TYPE_NORMAL, FUNCTION_TYPE_UDAF &#125; <span class="keyword">from</span> <span class="string">'constants/BindingItemsConstants'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="string">'./VirtualField.styl'</span></div></pre></td></tr></table></figure>
<h3 id="适当的距离"><a href="#适当的距离" class="headerlink" title="适当的距离"></a>适当的距离</h3><p>没有间距</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">handleAddNewUsers() &#123;</div><div class="line">	<span class="keyword">const</span> &#123; newUsers &#125; = <span class="keyword">this</span>.state</div><div class="line">	<span class="keyword">if</span> (isEmpty(newUsers)) <span class="keyword">return</span> Notification.error(<span class="string">'所选用户不能为空'</span>)</div><div class="line">	<span class="keyword">this</span>.props.updateUsersInUserGroup(<span class="keyword">this</span>.props.viewUserGroup.id, &#123;<span class="attr">userIds</span>: newUsers&#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</div><div class="line">	  responseNotification(response, <span class="string">'添加成功'</span>)</div><div class="line">	  <span class="keyword">this</span>.setState(&#123;<span class="attr">newUsers</span>: []&#125;)</div><div class="line">	&#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>很多间距</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">handleAddNewUsers() &#123;</div><div class="line">  </div><div class="line">    <span class="keyword">const</span> &#123; newUsers &#125; = <span class="keyword">this</span>.state</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (isEmpty(newUsers)) <span class="keyword">return</span> Notification.error(<span class="string">'所选用户不能为空'</span>)</div><div class="line">    </div><div class="line">    <span class="keyword">this</span>.props.updateUsersInUserGroup(<span class="keyword">this</span>.props.viewUserGroup.id, &#123;<span class="attr">userIds</span>: newUsers&#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</div><div class="line">    </div><div class="line">      responseNotification(response, <span class="string">'添加成功'</span>)</div><div class="line">      </div><div class="line">      <span class="keyword">this</span>.setState(&#123;<span class="attr">newUsers</span>: []&#125;)</div><div class="line">      </div><div class="line">    &#125;)</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>适当的间距</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">handleAddNewUsers() &#123;</div><div class="line">    <span class="keyword">const</span> &#123; newUsers &#125; = <span class="keyword">this</span>.state</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (isEmpty(newUsers)) <span class="keyword">return</span> Notification.error(<span class="string">'所选用户不能为空'</span>)</div><div class="line">    </div><div class="line">    <span class="keyword">this</span>.props.updateUsersInUserGroup(<span class="keyword">this</span>.props.viewUserGroup.id, &#123;<span class="attr">userIds</span>: newUsers&#125;)</div><div class="line">    	.then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</div><div class="line">      		responseNotification(response, <span class="string">'添加成功'</span>)</div><div class="line">      		<span class="keyword">this</span>.setState(&#123;<span class="attr">newUsers</span>: []&#125;)</div><div class="line">    	&#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>大家一起看看这段代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">handleSaveReport(&#123; name, directory, isSaveAsCopy &#125;) &#123;</div><div class="line">    <span class="keyword">const</span> &#123; workingReport, reportId &#125; = <span class="keyword">this</span>.props</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (isSaveAsCopy) &#123;</div><div class="line">      <span class="keyword">const</span> requestParams = saveReportCopyRequestParams(name, directory, workingReport)</div><div class="line">      <span class="keyword">this</span>.props.createReportCopy(requestParams, <span class="keyword">this</span>.state.directoryOfCurrentReport).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">        Notification.success(<span class="string">'另存成功'</span>)</div><div class="line">        <span class="keyword">this</span>.setState(&#123;<span class="attr">openSaveReportDialog</span>: <span class="literal">false</span>, <span class="attr">isSaveAsCopy</span>: <span class="literal">false</span>&#125;)</div><div class="line">      &#125;).catch(<span class="function">(<span class="params">errors</span>) =&gt;</span> forEach(errors, error =&gt; Notification.error(error)))</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">const</span> request = saveReportRequestParams(name, directory, workingReport)</div><div class="line">      <span class="keyword">this</span>.props.saveWorkingReport(reportId, request, <span class="keyword">this</span>.props.currentPageId).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">        Notification.success(<span class="string">'报表已保存'</span>)</div><div class="line">        <span class="keyword">this</span>.setState(&#123;<span class="attr">openSaveReportDialog</span>: <span class="literal">false</span>, <span class="attr">isSaveAsCopy</span>: <span class="literal">false</span>&#125;)</div><div class="line">      &#125;).catch(<span class="function">(<span class="params">errors</span>) =&gt;</span> forEach(errors, error =&gt; Notification.error(error)))</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h3 id="修改意见"><a href="#修改意见" class="headerlink" title="修改意见"></a>修改意见</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">handleSaveReport(&#123; name, directory, isSaveAsCopy &#125;) &#123;</div><div class="line">    <span class="keyword">const</span> &#123; workingReport, reportId &#125; = <span class="keyword">this</span>.props</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (isSaveAsCopy) &#123;</div><div class="line">    </div><div class="line">      <span class="keyword">const</span> requestParams = saveReportCopyRequestParams(name, directory, workingReport)</div><div class="line">      </div><div class="line">      <span class="keyword">this</span>.props.createReportCopy(requestParams, <span class="keyword">this</span>.state.directoryOfCurrentReport)</div><div class="line">	      .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">	        Notification.success(<span class="string">'另存成功'</span>)</div><div class="line">	        <span class="keyword">this</span>.setState(&#123;<span class="attr">openSaveReportDialog</span>: <span class="literal">false</span>, <span class="attr">isSaveAsCopy</span>: <span class="literal">false</span>&#125;)</div><div class="line">	      &#125;)</div><div class="line">	      .catch(<span class="function">(<span class="params">errors</span>) =&gt;</span> forEach(errors, error =&gt; Notification.error(error)))</div><div class="line">	      </div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">    </div><div class="line">      <span class="keyword">const</span> request = saveReportRequestParams(name, directory, workingReport)</div><div class="line">      </div><div class="line">      <span class="keyword">this</span>.props.saveWorkingReport(reportId, request, <span class="keyword">this</span>.props.currentPageId)</div><div class="line">	      .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">	        Notification.success(<span class="string">'报表已保存'</span>)</div><div class="line">	        <span class="keyword">this</span>.setState(&#123;<span class="attr">openSaveReportDialog</span>: <span class="literal">false</span>, <span class="attr">isSaveAsCopy</span>: <span class="literal">false</span>&#125;)</div><div class="line">	      &#125;)</div><div class="line">	      .catch(<span class="function">(<span class="params">errors</span>) =&gt;</span> forEach(errors, error =&gt; Notification.error(error)))</div><div class="line">	 &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h2 id="划重点（此处用力敲黑板）"><a href="#划重点（此处用力敲黑板）" class="headerlink" title="划重点（此处用力敲黑板）"></a>划重点（此处用力敲黑板）</h2><h3 id="1-有关联的代码放在一块，并且与其他代码块用空行隔开（垂直方向上的靠近与距离）"><a href="#1-有关联的代码放在一块，并且与其他代码块用空行隔开（垂直方向上的靠近与距离）" class="headerlink" title="1.有关联的代码放在一块，并且与其他代码块用空行隔开（垂直方向上的靠近与距离）"></a>1.有关联的代码放在一块，并且与其他代码块用空行隔开（垂直方向上的靠近与距离）</h3><h3 id="2-垂直顺序（自上而下的展示函数调用依赖顺序）"><a href="#2-垂直顺序（自上而下的展示函数调用依赖顺序）" class="headerlink" title="2.垂直顺序（自上而下的展示函数调用依赖顺序）"></a>2.垂直顺序（自上而下的展示函数调用依赖顺序）</h3><h2 id="横向格式"><a href="#横向格式" class="headerlink" title="横向格式"></a>横向格式</h2><h3 id="横向的间隔与靠近"><a href="#横向的间隔与靠近" class="headerlink" title="横向的间隔与靠近"></a>横向的间隔与靠近</h3><p>有横向间隔的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> quarter = <span class="built_in">Math</span>.floor((today.getMonth() + <span class="number">3</span>) / <span class="number">3</span>)</div></pre></td></tr></table></figure>
<p>删除这些横向间隔</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> quarter=<span class="built_in">Math</span>.floor((today.getMonth()+<span class="number">3</span>)/<span class="number">3</span>)</div></pre></td></tr></table></figure>
<h3 id="强调运算优先级"><a href="#强调运算优先级" class="headerlink" title="强调运算优先级"></a>强调运算优先级</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">…</div><div class="line"><span class="keyword">const</span> XXX = (<span class="built_in">Math</span>.…) + (a*<span class="number">2</span>)</div><div class="line">…</div></pre></td></tr></table></figure>
<p>横向格式应有空格的地方（此处用力敲黑板）</p>
<ul>
<li>运算符前后：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> view = <span class="keyword">this</span>.props.view</div></pre></td></tr></table></figure>
<ul>
<li>函数花括号前： </li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">handleChange() &#123;  …  &#125;</div></pre></td></tr></table></figure>
<ul>
<li>逗号后面：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">handleSave(arg1, arg2) &#123;  …  &#125;</div><div class="line"></div><div class="line">[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</div></pre></td></tr></table></figure>
<ul>
<li>解构:</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> &#123; id, name &#125; = view</div></pre></td></tr></table></figure>
<ul>
<li>……</li>
</ul>
<p>[slide]</p>
<p>{:&amp;.rollIn}</p>
<h2 id="格式（完）"><a href="#格式（完）" class="headerlink" title="格式（完）"></a>格式（完）</h2><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="使用函数"><a href="#使用函数" class="headerlink" title="使用函数"></a>使用函数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">describe(<span class="string">'buildSelectorValue'</span>, () =&gt; &#123;</div><div class="line">  it(<span class="string">'should return new selector when oldSelectors is empty'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> oldSelectors = &#123;&#125;</div><div class="line">    <span class="keyword">const</span> originalSelector = buildOriginalSelector(<span class="number">1</span>, [<span class="string">'四川'</span>])</div><div class="line">    <span class="keyword">const</span> exceptSelector = buildExceptSelector(<span class="number">1</span>, [<span class="string">'四川'</span>])</div><div class="line"></div><div class="line">    expect(buildSelectorValue(oldSelectors, originalSelector)).to.eql(exceptSelector)</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="使用常量"><a href="#使用常量" class="headerlink" title="使用常量"></a>使用常量</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">it(<span class="string">'should return selectors deleted by viewId'</span>, () =&gt; &#123;</div><div class="line">  expect(deleteSelectorByViewId(twoViewsState, deleteSelectorViewId)).to.eql(oneViewState)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">const</span> deleteSelectorViewId = <span class="string">'1'</span></div><div class="line"><span class="keyword">const</span> twoViewsState = &#123;</div><div class="line">  <span class="string">'1'</span>: &#123;</div><div class="line">    <span class="attr">pageId</span>: <span class="number">1</span>,</div><div class="line">    <span class="attr">dataSetId</span>: <span class="number">3</span>,</div><div class="line">    <span class="attr">values</span>: [&#123;</div><div class="line">      <span class="attr">fieldId</span>: <span class="number">4</span>,</div><div class="line">      <span class="attr">selectorValues</span>: [<span class="string">'四川'</span>]</div><div class="line">    &#125;]</div><div class="line">  &#125;,</div><div class="line">  <span class="string">'2'</span>: &#123;</div><div class="line">    <span class="attr">pageId</span>: <span class="number">1</span>,</div><div class="line">    <span class="attr">dataSetId</span>: <span class="number">3</span>,</div><div class="line">    <span class="attr">values</span>: [&#123;</div><div class="line">      <span class="attr">fieldId</span>: <span class="number">4</span>,</div><div class="line">      <span class="attr">selectorValues</span>: [<span class="string">'广东'</span>]</div><div class="line">    &#125;]</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">…</div></pre></td></tr></table></figure>
<h3 id="使用函数和常量的利与弊"><a href="#使用函数和常量的利与弊" class="headerlink" title="使用函数和常量的利与弊"></a>使用函数和常量的利与弊</h3><hr>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:center">利</th>
<th>弊</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">函数</td>
<td style="text-align:center">便于重用</td>
<td>逻辑复杂 </td>
</tr>
<tr>
<td style="text-align:left">函数</td>
<td style="text-align:center">不会暴露细节</td>
<td>不够直观</td>
</tr>
<tr>
<td style="text-align:left">常量</td>
<td style="text-align:center">无逻辑</td>
<td>重复太多</td>
</tr>
<tr>
<td style="text-align:left">常量</td>
<td style="text-align:center">够直观</td>
<td>异常点不是很明确</td>
</tr>
</tbody>
</table>
<h1 id="完"><a href="#完" class="headerlink" title="完"></a>完</h1>
      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/12/30/代码可读性-格式和测试/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-代码可读性-命名和函数" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/11/代码可读性-命名和函数/">代码可读性-命名和函数</a>
    </h1>
  

        <a href="/2016/12/11/代码可读性-命名和函数/" class="archive-article-date">
  	<time datetime="2016-12-11T01:40:09.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2016-12-11</time>
</a>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="为什么要讲代码可读性-编辑器回放"><a href="#为什么要讲代码可读性-编辑器回放" class="headerlink" title="为什么要讲代码可读性-编辑器回放"></a>为什么要讲代码可读性-编辑器回放</h2><p>在讲代码可读性之前，我们想想为什么要讲代码可读性？代码可读性究竟有这么重要吗？先来看一个下例子。</p>
<p>你是否也玩过<strong>编辑器回放</strong>？有的编辑器可以记录每次击键动作，当一段时间后回放击键过程，就像是看一部告诉电影，十分有趣。回放的过程显示，多数时间我们是在滚动屏幕、阅读代码，就像这样。</p>
<ul>
<li>Bob进入模块</li>
<li>他向下滚动到要修改的函数</li>
<li>他停下来考虑可以做什么</li>
<li>他滚动到模块顶端，检查变量初始化</li>
<li>现在他回到修改处，开始键入</li>
<li>他删掉了键入的内容</li>
<li>他又重新键入</li>
<li>他又删除了</li>
<li>他键入了一半什么东西，又删掉了</li>
<li>他滚动到调用要修改函数的另一函数，看看是怎么调用的</li>
<li>他回到修改处，重新键入刚才删掉的代码……</li>
</ul>
<p>可能你已经发现，我们在写代码的时候花了大量的时间阅读老代码。写新代码的时间相对于阅读老代码的时间非常少。那么，我们是不是该谈一谈代码的可读性呢？</p>
<p>本文将从两方面来讲代码可读性，命名和函数。</p>
<h2 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h2><h4 id=""><a href="#" class="headerlink" title=" "></a> </h4><ol>
<li>名副其实</li>
<li>避免误导</li>
<li>避免空泛的名字</li>
<li>避免单字母命名</li>
<li>有意义的区分</li>
<li>为名称附带跟多的信息</li>
<li>使用读得出来的名字</li>
<li>可搜索的名字</li>
<li>类名</li>
<li>方法名</li>
<li>每个概念对应一个词</li>
<li>使用专业的单词</li>
<li>为作用域大的名字采用更长的名字</li>
<li>只使用众所周知的缩写</li>
<li>尊重开发人员的直觉</li>
<li>Airbnb命名规则</li>
</ol>
<h3 id="1-名副其实"><a href="#1-名副其实" class="headerlink" title="1.名副其实"></a>1.名副其实</h3><p>一段名不副实的代码是这样的。也许读者能看懂这段代码要做件什么事儿，但是无法理解作者到底要做一件怎样的事儿。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> List&lt;<span class="keyword">int</span> []&gt; getThem() &#123;</div><div class="line">  List &lt;<span class="keyword">int</span>[]&gt; list1 = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">int</span>[]&gt;();</div><div class="line">  <span class="keyword">for</span> (&lt;<span class="keyword">int</span>[]&gt; x : theList)</div><div class="line">    <span class="keyword">if</span> (x[<span class="number">0</span>] == <span class="number">4</span>)</div><div class="line">      list1.add(x);</div><div class="line">  <span class="keyword">return</span> list1;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>但是稍加修改一下，这段代码可读性大大提高。我们能重头到尾很顺畅的读懂这段代码，就是要把被标记了的格子放到一个叫<code>flaggedCells</code>的数组里面。就像读一个小故事一样简单。名副其实的命名一定要<strong>表达该函数或常量的真实意义</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> List&lt;<span class="keyword">int</span> []&gt; getFlaggedCells() &#123;</div><div class="line">  List &lt;<span class="keyword">int</span>[]&gt; flaggedCells = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">int</span>[]&gt;();</div><div class="line">  <span class="keyword">for</span> (&lt;<span class="keyword">int</span>[]&gt; cell : gameBoard)</div><div class="line">    <span class="keyword">if</span> (cell[STATUS_VALUE] == FLAGGED)</div><div class="line">      flaggedCells.add(cell);</div><div class="line">  <span class="keyword">return</span> flaggedCells;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-避免误导"><a href="#2-避免误导" class="headerlink" title="2.避免误导"></a>2.避免误导</h3><p>在DataSetDataPreview这个组件里，有dataSetPreviewData和previewData两个误导读者的属性，这两个属性看似一样，无法分辨其不同之处，严重误导了读者。如果修改代码时，读到了这里。读者需要花大量的时间去分辨这俩个属性的具体含义，严重的降低工作效率。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;DataSetDataPreview</div><div class="line">  dataSetPreviewData=&#123;<span class="keyword">this</span>.props.dataSetPreviewData&#125;</div><div class="line">  fields=&#123;fieldObj&#125;</div><div class="line">  previewData=&#123;<span class="keyword">this</span>.props.previewData&#125;</div><div class="line">  onUpdate=&#123;<span class="keyword">this</span>.props.onUpdatePreview&#125;</div><div class="line">/&gt;</div></pre></td></tr></table></figure>
<h3 id="3-避免空泛的名字"><a href="#3-避免空泛的名字" class="headerlink" title="3.避免空泛的名字"></a>3.避免空泛的名字</h3><p>避免使用像tmp、retval这样的名字。空泛的名字无法表达应有的含义，尽量用具有描述性的名字。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">String</span> tmp = user.name();</div><div class="line">tmp += <span class="string">" "</span> + user.phone_number();</div><div class="line">tmp += <span class="string">" "</span> + user.email();</div><div class="line">...</div><div class="line">template.set(<span class="string">"user_info"</span>, tmp);</div></pre></td></tr></table></figure>
<h3 id="4-避免单字母命名"><a href="#4-避免单字母命名" class="headerlink" title="4.避免单字母命名"></a>4.避免单字母命名</h3><p>避免像<code>f</code>这样子的命名,这里的<code>f</code>完全不能表达该变量的实际意义。单字母命名实在是很让人费解。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;tr&gt;&#123;<span class="keyword">this</span>.headerItems(<span class="function"><span class="params">f</span> =&gt;</span> f.displayName)&#125;&lt;<span class="regexp">/tr&gt;</span></div></pre></td></tr></table></figure>
<p>尽管在map中，同样推荐将变量命名完整一点。比如下面⬇️的column。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> map(previewData.columns, column =&gt; &#123;</div><div class="line">  <span class="keyword">const</span> field = fieldMap[column]</div><div class="line">	…  </div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>但是如果在单行的函数中，可以酌情使用。例如，由于有了前面的columns，我们很容易联想到<code>c</code>指代的时<code>column</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">map(columns, (c) =&gt; c.xxx )</div></pre></td></tr></table></figure>
<h3 id="5-有意义的区分"><a href="#5-有意义的区分" class="headerlink" title="5.有意义的区分"></a>5.有意义的区分</h3><p>避免使用ProductInfo、ProductData这样的名称，这两个名字看起来和Product没有什么区别。同样不要使用类似theUser、nameString的名称，theUser和user没有什么区别，同时name也不可能是个数字或者布尔值吧。</p>
<blockquote>
<ul>
<li>varibale一词永远不应当出现在变量名中。</li>
<li>要区分名称，就要以读者能鉴别不同之处的方式来区分。</li>
</ul>
</blockquote>
<h3 id="6-为名称附带更多的信息"><a href="#6-为名称附带更多的信息" class="headerlink" title="6.为名称附带更多的信息"></a>6.为名称附带更多的信息</h3><p>尽可能在名字中把名称应该表达的信息都表达出来。</p>
<ul>
<li>如果是命名一个ID的话，使用currentPageId肯定比CurrentPage好得多。</li>
<li>在一个满是dataSet的组件中，selectedDataSet比dataset更能表明这是一个选中的dataSet。</li>
</ul>
<h3 id="7-使用读的出来的名字"><a href="#7-使用读的出来的名字" class="headerlink" title="7.使用读的出来的名字"></a>7.使用读的出来的名字</h3><p>不知道你有没有把文字在心中或者嘴里念出来的习惯，据我所知很多人是会在脑子里读一下。genymdhms这样子的名称先不讨论其表达的含义，如果碰见这样子的名称，该怎么读呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">…</div><div class="line"><span class="keyword">private</span> Date genymdhms;</div><div class="line"><span class="keyword">private</span> Date modmdhms;  </div><div class="line">…</div></pre></td></tr></table></figure>
<p>如果这样子命名是不是好读得多？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">…</div><div class="line"><span class="keyword">private</span> Date generationTimestamp;</div><div class="line"><span class="keyword">private</span> Date modificationTimestamp;  </div><div class="line">…</div></pre></td></tr></table></figure>
<h3 id="8、可搜索的名字"><a href="#8、可搜索的名字" class="headerlink" title="8、可搜索的名字"></a>8、可搜索的名字</h3><p>为什么要使用可以搜索的名字？想找到WOERK_DAY_PRE_WEEK很容易，但是想找到数字5就不那么容易了。</p>
<ul>
<li>作用域越大越需要搜索</li>
<li>少使用缩写</li>
<li>名称做够详尽（变量名要详细）</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> WOERK_DAY_PRE_WEEK ＝<span class="number">5</span></div></pre></td></tr></table></figure>
<p>如果你是这样子命名的，那想要搜索找到User可能没那么容易吧。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">models/User.js</div><div class="line">controllers/User.js</div><div class="line">services/User.js</div><div class="line">presentations/User.js</div><div class="line">…</div><div class="line">xxx/User.js</div><div class="line">…</div></pre></td></tr></table></figure>
<p>把名字写详尽，比如像这样子。搜索User或者UserController变得轻而易举。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">models/User.js</div><div class="line">controllers/UserController.js</div><div class="line">services/UserService.js</div><div class="line">presentations/UserPresentation.js</div></pre></td></tr></table></figure>
<h3 id="9-类名"><a href="#9-类名" class="headerlink" title="9.类名"></a>9.类名</h3><blockquote>
<p>类名和对象名应该是名词或名词短语，如Customer、WikiPage、Account<br>和AddressParser。避免使用Manager、Processor、Data或Info这样的类名。类名不应当是动词。</p>
</blockquote>
<h3 id="10-方法名"><a href="#10-方法名" class="headerlink" title="10.方法名"></a>10.方法名</h3><blockquote>
<p>方法名应当是动词或动词短语，如postPayment、deletePage或save。</p>
</blockquote>
<h3 id="11-每个概念对应一个词"><a href="#11-每个概念对应一个词" class="headerlink" title="11.每个概念对应一个词"></a>11.每个概念对应一个词</h3><p>例如在新建数据集里，有这些组件，但实际上都是一个概念，表示新建。应当用同一个名字来表述，create或者add取其一。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;AddDataSetRDB /&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">AddDataSetReplacement</span> /&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">AddDataSetStep</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">CreateDataSetHome</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">CreateDataSetItem</span> /&gt;</span></div></pre></td></tr></table></figure>
<h3 id="12-使用专业的单词"><a href="#12-使用专业的单词" class="headerlink" title="12.使用专业的单词"></a>12.使用专业的单词</h3><p>同样是从一个url获取page，可能是从本地、网上获取，或者是从网上下载。看起来都可以用getPage来表示，但是请使用专业的单词来区分一下。例如：</p>
<ul>
<li>如果从本地获取，且轻量级的</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">getPage(url)</div></pre></td></tr></table></figure>
<ul>
<li>如果从网上获取</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fetchPage(url)</div></pre></td></tr></table></figure>
<ul>
<li>如果从网上下载</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">downloadPage(url)</div></pre></td></tr></table></figure>
<p>下面这个类，作者期望Size()方法返回什么呢?树的高度、节点数还是数在内存中所占的空间？size()可以指代很多东西，size()的范围太广了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BinaryTree</span>  </span>&#123; </div><div class="line">  <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;    </div><div class="line">  ...</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>Size()没有承载很多信息，更专业的词应该是height()、nodesCount()。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BinaryTree</span>  </span>&#123; </div><div class="line">  <span class="function"><span class="keyword">int</span> <span class="title">height</span><span class="params">()</span></span>;</div><div class="line">  <span class="function"><span class="keyword">int</span> <span class="title">nodesCount</span><span class="params">()</span></span>;    </div><div class="line">  ...</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="13-为作用域大的名字采用更长的名字"><a href="#13-为作用域大的名字采用更长的名字" class="headerlink" title="13.为作用域大的名字采用更长的名字"></a>13.为作用域大的名字采用更长的名字</h3><p>在单个循环中使用i、j、k这样子的单字母命名并无大碍。但是像这样在多重嵌套循环的情况，再使用i、j、k，读起来就会感到吃力了。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; clubs.size(); i++)    </div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; clubs[i].members.size(); j++)        </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; users.size(); k++)         </div><div class="line">      <span class="keyword">if</span> (clubs[i].members[k] == users[j])             </div><div class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"user["</span> &lt;&lt; j &lt;&lt; <span class="string">"] is in club["</span> &lt;&lt; i &lt;&lt; <span class="string">"]"</span> &lt;&lt; <span class="built_in">endl</span>;</div></pre></td></tr></table></figure>
<p>给i、j、k赋予更有意义的名字，例如clubIndex、memberIndex、userIndex。这样子就一目了然了。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> clubIndex = <span class="number">0</span>; clubIndex &lt; clubs.size(); clubIndex++)    </div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> memberIndex = <span class="number">0</span>; memberIndex &lt; clubs[clubIndex].members.size(); memberIndex++)        </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> userIndex = <span class="number">0</span>; userIndex &lt; users.size(); userIndex++)         </div><div class="line">      <span class="keyword">if</span> (clubs[clubIndex].members[memberIndex] == users[j])             </div><div class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"user["</span> &lt;&lt; memberIndex &lt;&lt; <span class="string">"] is in club["</span> &lt;&lt; clubIndex &lt;&lt; <span class="string">"]"</span> &lt;&lt; <span class="built_in">endl</span>;</div></pre></td></tr></table></figure>
<h3 id="14-只使用众所周知的缩写"><a href="#14-只使用众所周知的缩写" class="headerlink" title="14.只使用众所周知的缩写"></a>14.只使用众所周知的缩写</h3><p>缩写一定只使用众所周知的，千万不要使用自己编造的缩写。不然就只有作者和上帝知道是什么意思了，可能过一段时间后就只有上帝知道什么意思了。看下面第三行中fetchNParseHtml这个名字，你知道中间大写的N是什么意思吗?其实N是and的意思，这并不是自己编造缩写，但是并不属于众所周知的缩写。还是尽量不要使用的好。而且在满是驼峰命名的代码里，一个大写的N并不是那么明显。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>     --&gt; doc</div><div class="line">string       --&gt; str</div><div class="line">fetchNParseHtml  --&gt; ?</div></pre></td></tr></table></figure>
<h3 id="15-尊重开发人员的直觉"><a href="#15-尊重开发人员的直觉" class="headerlink" title="15.尊重开发人员的直觉"></a>15.尊重开发人员的直觉</h3><p>取一个合适的名字，让其他开发者能明白calculateMean()是一个会消耗一定资源的方法，不然其他开发者可能会随意使用这个方法，而不考虑性能问题。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StatisticsCollector</span> </span>&#123;    </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSample</span><span class="params">(<span class="keyword">double</span> x)</span> </span>&#123; ... &#125;    </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getMean</span><span class="params">()</span> </span>&#123;        </div><div class="line">    <span class="comment">// Iterate through all samples and return total / num_samples    &#125;    </span></div><div class="line">...&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StatisticsCollector</span> </span>&#123;    </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSample</span><span class="params">(<span class="keyword">double</span> x)</span> </span>&#123; ... &#125;    </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">calculateMean</span><span class="params">()</span> </span>&#123;        </div><div class="line">    <span class="comment">// Iterate through all samples and return total / num_samples    &#125;    </span></div><div class="line">...&#125;</div></pre></td></tr></table></figure>
<h3 id="16-Airbnb命名规则"><a href="#16-Airbnb命名规则" class="headerlink" title="16.Airbnb命名规则"></a>16.Airbnb命名规则</h3><p>对比一下Airbnb的JavaScript命名规范，基本与上述原则一致。</p>
<ul>
<li>避免单字母命名。命名应具备描述性</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">q</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// ...stuff...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">query</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// ..stuff..</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>使用驼峰式命名对象、函数和实例</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="keyword">const</span> OBJEcttsssss = &#123;&#125;;</div><div class="line"><span class="keyword">const</span> this_is_my_object = &#123;&#125;;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line"><span class="keyword">const</span> thisIsMyObject = &#123;&#125;;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">thisIsMyFunction</span>(<span class="params"></span>) </span>&#123;&#125;</div></pre></td></tr></table></figure>
<ul>
<li>使用帕斯卡式命名构造函数或类</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">user</span>(<span class="params">options</span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.name = options.name;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(options) &#123;</div><div class="line">    <span class="keyword">this</span>.name = options.name;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>使用下划线 _ 开头命名私有属性</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="keyword">this</span>.__firstName__ = <span class="string">'Panda'</span>;</div><div class="line"><span class="keyword">this</span>.firstName_ = <span class="string">'Panda'</span>;</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line"><span class="keyword">this</span>._firstName = <span class="string">'Panda'</span>;</div></pre></td></tr></table></figure>
<ul>
<li>如果你的文件只输出一个类，那你的文件名必须和类名完全保持一致</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// file contents</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CheckBox</span> </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> CheckBox;</div><div class="line"></div><div class="line"><span class="comment">// in some other file</span></div><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="keyword">import</span> CheckBox <span class="keyword">from</span> <span class="string">'./checkBox'</span>;</div><div class="line"></div><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="keyword">import</span> CheckBox <span class="keyword">from</span> <span class="string">'./check_box'</span>;</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line"><span class="keyword">import</span> CheckBox <span class="keyword">from</span> <span class="string">'./CheckBox'</span>;</div></pre></td></tr></table></figure>
<ul>
<li>当你导出默认的函数时使用驼峰式命名。你的文件名必须和函数名完全保持一致</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeStyleGuide</span>(<span class="params"></span>) </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> makeStyleGuide;</div></pre></td></tr></table></figure>
<ul>
<li>当你导出单例、函数库、空对象时使用帕斯卡式命名</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> AirbnbStyleGuide = &#123;</div><div class="line">  <span class="attr">es6</span>: &#123;</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> AirbnbStyleGuide;</div></pre></td></tr></table></figure>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>函数与可读性有什么关系呢？先看一个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">handleAppend() &#123;</div><div class="line">    <span class="keyword">const</span> &#123; form &#125; = <span class="keyword">this</span>.props</div><div class="line">    <span class="keyword">const</span> charset = <span class="keyword">this</span>.props.charset</div><div class="line">    <span class="keyword">const</span> options = form.Append.options</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state.headerValid == <span class="literal">false</span>) &#123;</div><div class="line">      Notification.warn(<span class="string">'请选择对应的文件'</span>)</div><div class="line">      <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">const</span> path = <span class="keyword">this</span>.props.form.Append.options.textPath.value</div><div class="line">    <span class="keyword">if</span> (isUndefined(options.description) || isEmpty(options.description.value)) &#123;</div><div class="line">      Notification.warn(<span class="string">'请填写数据说明'</span>)</div><div class="line">      <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">const</span> description = <span class="keyword">this</span>.props.form.Append.options.description.value</div><div class="line">    <span class="keyword">const</span> dataSetId = <span class="keyword">this</span>.props.relatedDataSet.id</div><div class="line">    <span class="keyword">let</span> data = &#123;&#125;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.props.relatedDataSource.dataSourceType == <span class="string">'CSV'</span>) &#123;</div><div class="line">      data.csvPath = path</div><div class="line">      data.charset = charset</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      data.excelPath = path</div><div class="line">    &#125;</div><div class="line">    data.description = description</div><div class="line">    </div><div class="line">    <span class="keyword">this</span>.props.dataSetAppend(dataSetId, data).then(<span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</div><div class="line">      <span class="keyword">if</span> (action.errors &amp;&amp; !action.message) &#123;</div><div class="line">        <span class="keyword">if</span> (action.errors[<span class="number">0</span>]) &#123;</div><div class="line">          Notification.warn(action.errors[<span class="number">0</span>], <span class="number">1</span>)</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          Notification.warn(action.message, <span class="number">1</span>)</div><div class="line">        &#125;</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        Notification.success(<span class="string">'追加成功'</span>)</div><div class="line">        <span class="keyword">this</span>.props.updateSelectedTabIndex(<span class="number">5</span>)</div><div class="line">        <span class="keyword">this</span>.props.loadImportHistory(<span class="keyword">this</span>.props.relatedDataSet.id)</div><div class="line">        <span class="keyword">this</span>.props.goToDataSets()</div><div class="line">        <span class="keyword">this</span>.handleCleanAppendFields()</div><div class="line">        <span class="keyword">this</span>.handleCleanAppendPreview()</div><div class="line">        <span class="keyword">this</span>.props.cleanCharSet()</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>这个函数有41行之多，可以看到函数里面做了三件事。验证、组装请求数据和调用action。当我看到要改这个函数时就感到非常可怕，内心是拒绝去看这个函数。因为它实在太长了。后来把它改成这样，把验证、组装请求数据和请求成后的回调分别抽离出来，似乎可读性变高了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">handleConfirmAppend() &#123;</div><div class="line">  <span class="keyword">const</span> &#123;</div><div class="line">    appendLocalFileRelatedDataSet,</div><div class="line">    dataSetAppend,</div><div class="line">    isHeaderValid,</div><div class="line">    <span class="attr">appendForm</span>: &#123; <span class="attr">options</span>: &#123; description &#125; &#125;</div><div class="line">  &#125; = <span class="keyword">this</span>.props</div><div class="line">  <span class="keyword">const</span> validate = validateDescriptionAndHeader(description, isHeaderValid)</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (validate.hasError) <span class="keyword">return</span> message.error(validate.message)</div><div class="line"></div><div class="line">  <span class="keyword">const</span> dataSetId = appendLocalFileRelatedDataSet.id</div><div class="line">  <span class="keyword">const</span> requestBody = <span class="keyword">this</span>.composeAppendRequestBody()</div><div class="line"></div><div class="line">  dataSetAppend(dataSetId, requestBody).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</div><div class="line">    responseNotification(response, <span class="string">'追加成功'</span>, <span class="keyword">this</span>.handleAppendSuccessCallBack)</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>提高函数的可读性，可以从以下几个方面着手：</p>
<ol>
<li>短小</li>
<li>只做一件事</li>
<li>函数参数</li>
<li>无副作用</li>
<li>別重复自己</li>
<li>如何写出这样的函数</li>
</ol>
<h3 id="1-短小"><a href="#1-短小" class="headerlink" title="1.短小"></a>1.短小</h3><blockquote>
<p>函数的第一规则是要短小,第二条规则则是还要更短小。</p>
</blockquote>
<p>函数越短小，读者越容易看懂这个函数。短小的函数比起大函数更有条理，让读者阅读起来更轻松。</p>
<h3 id="2-只做一件事"><a href="#2-只做一件事" class="headerlink" title="2.只做一件事"></a>2.只做一件事</h3><blockquote>
<p>函数应该做一件事，做好这件事，只做一件事。</p>
</blockquote>
<p>函数应该只做与之名字相对应的事，否则就有可能使读者产生误解。如果读者不熟悉函数内部做了其他事，就会增加改出Bug得几率。因为他并不知道你还做了其他的事儿。</p>
<h3 id="3-函数参数"><a href="#3-函数参数" class="headerlink" title="3.函数参数"></a>3.函数参数</h3><blockquote>
<p>最理想的参数数量是零，其次是一，再次是二，应尽量避免三</p>
</blockquote>
<h3 id="4-无副作用"><a href="#4-无副作用" class="headerlink" title="4.无副作用"></a>4.无副作用</h3><blockquote>
<p>函数承诺只做一件事，但还是会做其他被藏起来的事</p>
</blockquote>
<p>在这个UserValidator的类中，不光对user做了验证，同时还做了初始化，这就是一个副作用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> class <span class="title">UserValidator</span> <span class="params">(</span></span></div><div class="line">  …</div><div class="line">  <span class="keyword">if</span> (<span class="string">"Valid Password"</span>.equals(phrase)) &#123;</div><div class="line">    Session.initialize();</div><div class="line">    …</div><div class="line">  &#125;</div><div class="line">  …</div><div class="line">)</div></pre></td></tr></table></figure>
<p>如果一定要时序性耦合，就应当在函数名称中说明，例如把UserValidator改成checkPasswordAndInitializeSession</p>
<h3 id="5-別重复自己"><a href="#5-別重复自己" class="headerlink" title="5.別重复自己"></a>5.別重复自己</h3><blockquote>
<p>重复可能是软件中一切邪恶的根源</p>
</blockquote>
<h3 id="6-如何写出这样的函数"><a href="#6-如何写出这样的函数" class="headerlink" title="6.如何写出这样的函数"></a>6.如何写出这样的函数</h3><p>在写代码时，实在是很难做到以上这几点。但这并不能成为我们写烂代码的借口。但是我们可以这样子做，来保证我们的代码质量。</p>
<ul>
<li>想什么写什么</li>
<li>然后打磨它</li>
<li>单元测试</li>
<li>分解函数</li>
<li>修改名称</li>
<li>消除重复</li>
<li>保持测试通过</li>
</ul>
<p><strong>在不久的将来，我们写的每一段代码，都有可能被自己或者别的开发者阅读修改。如果想要给未来的自己或者其他开发者省一点时间，建议在创造代码时一定要考虑到将来读者的感受，一定要让读者看到你的代码时不得不说出赞美的词。</strong></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/代码可读性/">代码可读性</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2016/12/11/代码可读性-命名和函数/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Dragon Orange
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js?v=4.0.0.js"></script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)">React</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)">代码可读性</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、在博客根目录（注意不是yilia根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            2、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: true
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接1</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接2</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接3</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接4</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接5</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接6</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">很惭愧&lt;br&gt;&lt;br&gt;只做了一点微小的工作&lt;br&gt;谢谢大家</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>